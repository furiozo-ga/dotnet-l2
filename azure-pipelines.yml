# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pool:
#  name: p1
  vmImage: ubuntu-latest

#container: node:17-bullseye
#container: node:17-bullseye-slim
#container: node:17-alpine
#container: furiozoga/semantic-release:0.0.1
#container: furiozoga/dotnetsdk:latest

steps:
- checkout: self
  clean: false
  persistCredentials: true

#- bash: echo Hello, world! bash
#  displayName: 'Run a one-line script'

- task: Npm@1
  enabled: false
  inputs:
    command: 'install'

- bash: |
    export TIME=$"command: %C\ttime: %e s\tmem: %M kB\texit code: %x"
    t='command time'
    #which pigz
    #npm install
    $t curl -L https://github.com/furiozo-ga/dl/releases/download/semrel-001/node_modules.tar.gz | tar mx -I pigz
    #$t uname -a
    #$t echo $(System.AccessToken)
    #$t git config -l
    #$t cat .git/config
    #$t cat /etc/issue
    cat /proc/cpuinfo | grep name
    $t free
    $t node -v
    $t npm -v
    $t npx -v
    $t npx semantic-release -v
    $t npm ls
  displayName: 'diagnostics'

- task: Bash@3
  displayName: semantic-release
  inputs:
    failOnStderr: true
    targetType: 'inline'
    script: |
      # Write your commands here
      npx semantic-release --no-ci

- task: Bash@3
  enabled: false
  inputs:
    targetType: 'inline'
    script: |
      # Write your commands here
      echo 'Hello world 2'
    failOnStderr: true